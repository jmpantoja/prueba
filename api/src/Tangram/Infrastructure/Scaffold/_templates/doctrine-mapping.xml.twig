{% import 'partials/macros.php.twig' as _ %}
<doctrine-mapping xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
                  xsi:schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping
                          https://www.doctrine-project.org/schemas/orm/doctrine-mapping.xsd">

    <entity name="{{ entity | full_name }}" table="{{ entity | table_name }}">
        <id name="id" column="id" type="{{ entityId | short_name }}"/>

        {% for attribute in entity.attributes %}

            {%- if attribute.relation %}
                {%- if attribute.oneToOne %}
                    {{- _self.oneToOne(attribute) -}}
                {%- elseif attribute.oneToMany %}
                    {{- _self.oneToMany(attribute) -}}
                {%- elseif attribute.manyToOne %}
                    {{- _self.manyToOne(attribute) -}}
                {%- elseif attribute.manyToMany %}
                    {{- _self.manyToMany(attribute) -}}
                {%- endif %}
            {%- else %}
                {%- if (attribute.type | ref).composed %}
                    {{- _self.embeddable(attribute) -}}
                {%- else %}
                    {{- _self.field(attribute) -}}
                {%- endif %}
            {% endif %}

        {% endfor %}

    </entity>

</doctrine-mapping>

{% macro  oneToOne(attribute) %}
    <one-to-one field="{{ attribute.name }}" target-entity="{{ attribute | full_name }}"/>
{% endmacro %}

{% macro  oneToMany(attribute) %}
    <one-to-many field="{{ attribute.name }}"
                 target-entity="{{ attribute | full_name }}"
                 mapped-by="{{ attribute | mapping_field }}"
                 orphan-removal="true">
    <cascade>
        <cascade-persist/>
    </cascade>
    </one-to-many>
{% endmacro %}

{% macro  manyToOne(attribute) %}
    <many-to-one field="{{ attribute.name }}" target-entity="{{ attribute | full_name }}"/>
{% endmacro %}

{% macro  manyToMany(attribute) %}
    <many-to-many field="{{ attribute.name }}" target-entity="{{ attribute | full_name }}" orphan-removal="true">
    <cascade>
        <cascade-persist/>
    </cascade>
    </many-to-many>

{% endmacro %}

{% macro  embeddable(attribute) %}
    <embedded name="{{ attribute.name }}" class="{{ attribute | full_name }}"/>
{% endmacro %}

{% macro  field(attribute) %}
    <field name="{{ attribute.name }}" type="{{ attribute | dbal_type }}"/>
{% endmacro %}
